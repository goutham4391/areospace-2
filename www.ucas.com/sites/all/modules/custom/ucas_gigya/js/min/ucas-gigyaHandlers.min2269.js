var UCASDesignFramework=UCASDesignFramework||{};!function(e,t,a){"use strict";var n={userData:{},hasGigyaSession:!1,hasDrupalLogin:!1,useCentralLogin:!1,ssoCalled:!1,fetching:!0,context:{},settings:{},isMobileApp:!1,checkLogin:function(e,t){n.context=e,n.settings=t,n.useCentralLogin=!!t.hasOwnProperty("useCentralLogin")&&t.useCentralLogin;var r=!!t.hasOwnProperty("gigyaToken")&&t.gigyaToken;n.isMobileApp="Mobile"===a.get(window.gigya,"_.apiAdapter.name",!1),n.gigyaTokenFix(),n.hasGigyaSession=r&&!1!==this.getCookie(r)||n.isMobileApp,n.hasDrupalLogin=t.hasOwnProperty("isDrupalLogin")&&!0===t.isDrupalLogin;var o="true"===this.getCookie("ucasGigyaLogout");n.hasGigyaSession||(this.clearUserInfo(),this.removeCookie("ucasGigyaSoft")),o?n.gigyaLogout():n.getUserInfo(!1,!0).then((function(e){console.log("Login checked");var t="true"===n.getCookie("ucasGigyaSoft");if(n.hasGigyaSession=r&&!1!==n.getCookie(r)||n.isMobileApp,!n.hasDrupalLogin&&"false"!==n.getQueryArgument("auth")&&n.hasGigyaSession&&!o&&!t&&!n.isMobileApp){console.log("Firing fallback login callback");var a={profile:{email:e.email}};return n.loginCallback(a,"verification-complete"!==n.getQueryArgument("m")),void n.initGigyaUI()}n.initGigyaUI()}))},gigyaTokenFix:function(){var e=!!n.settings.hasOwnProperty("gigyaToken")&&n.settings.gigyaToken;e&&(document.cookie=e+"=;domain=."+window.location.hostname+";path=/;expires="+new Date(0).toUTCString())},loginRedirect:function(){n.clearUserInfo(),window.location="/account?m=login&returnUrl="+window.location.pathname},initGigyaUI:function(){var t=e("body");n.hasGigyaSession?(t.removeClass("gigya-logged-out"),t.addClass("gigya-logged-in")):(t.removeClass("gigya-logged-in"),t.addClass("gigya-logged-out"));var r=e(".page-students .region--content");r.find('a.button[href^="'+window.location.origin+'/account?"]').each((function(t,a){n.hasGigyaSession&&e(a).remove()})),r.find('a.button[href^="'+window.location.origin+'/dashboard"], a.button[href*="/search/dashboard"]').each((function(t,a){n.hasGigyaSession||e(a).remove()}));var o=a.get(n,"userData.firstName","")+" "+a.get(n,"userData.lastName",""),i=a.get(n,"userData.email","");e('*:contains("{{ fullName }}")').each((function(t,a){var n=e(a).html().replace("{{ fullName }}",o);e(a).html(n)})),e('input[value="{{ fullName }}"]').each((function(t,a){e(a).attr("value",o)})),e('*:contains("{{ email }}")').each((function(t,a){var n=e(a).html().replace("{{ fullName }}",i);e(a).html(n)})),e('input[value="{{ email }}"]').each((function(t,a){e(a).attr("value",i)})),n.insertScreenSet(),n.replaceLoginMenu(),n.bindClickHandlers(),n.insertFavourites(),console.log("Initialised gigya UI")},insertScreenSet:function(){var t=e("#ucas-gigya-screenset:not(.ucas-gigya-screenset--initialised)");n.gigyaTokenFix(),t.length>0&&(gigya.accounts.showScreenSet({screenSet:t.data("screensetName"),startScreen:t.data("startScreenId"),onAfterSubmit:n.screenSetSubmit}),t.addClass("ucas-gigya-screenset--initialised"))},insertFavourites:function(){if(n.settings.hasOwnProperty("gigyaFavourite")){var t=n.settings.gigyaFavourite,a=["title"],r={title:t.hasOwnProperty("title")?t.title:e("h1#page-title").text()};t.hasOwnProperty("id")&&(r.id=t.id,a=["id"]),t.hasOwnProperty("sub-type")&&(r.type=t["sub-type"]);var o=n.createFavouriteLink({key:a,type:t.type,data:r});e("body.page-node").find(".section--lower-header .header__actions").append(o)}},createFavouriteLink:function(t,a){var r="",o="page-favourite__link",i="<span>Add to favourites</span>",s=e('<div class="page-favourite"></div>');void 0!==a&&(r=void 0!==a.additionalClasses?a.additionalClasses:r,o=void 0!==a.class?a.class:o,i=void 0!==a.element?a.element:i,s=void 0!==a.wrapperElement?a.wrapperElement:s);var l=e(i);return l.addClass(o),r.length&&l.addClass(r),n.getUserInfo().then((function(e){n.isFavourite(t,e)&&(l.addClass(o+"--active"),l.attr("aria-pressed",!0))})),l.on("click",(function(e){e.stopPropagation(),l.addClass(o+"--working"),n.toggleFavourite(t,!0,o).then((function(e){l.removeClass(o+"--working"),l.toggleClass(o+"--active",e.isFavourite)}))})),s.length?l.wrap(s).parent():l},isFavourite:function(e,t){var n=[].concat(e.key),r=!1;return t.favourites&&t.favourites.hasOwnProperty(e.type)&&(r=void 0!==a.find(t.favourites[e.type],a.pick(e.data,n))),r},setFavourites:function(e,t){return new Promise((function(r,o){n.getUserInfo().then((function(i){if(i.UID){var s=!1;if("courses"===e&&i.favourites.top.forEach((function(e,n){var r=a.get(e,"course.courseId",!1),o=a.get(e,"course.courseOptionId",!1);r&&o&&(a.find(t,{courseId:r,courseOptionId:o})||(i.favourites.top[n]={number:e.number,course:{courseId:!1,courseOptionId:!1}},s=!0))})),i.favourites.hasOwnProperty(e)||(i.favourites[e]=[]),i.favourites[e]=t,n.updateUserInfo(i),!1!==i.UID){var l={};l[e]=t,s&&(l.top=i.favourites.top),n.gigyaTokenFix(),gigya.accounts.setAccountInfo({callback:function(t){0===t.errorCode?(console.log("Favourite "+e+" updated on Gigya"),r(i.favourites)):403005===t.errorCode?n.loginRedirect():o()},data:{learnerProfile:{favourites:l}}})}else r(i.favourites)}else o("Missing Gigya ID")}))}))},toggleFavourite:function(t,r,o){return new Promise((function(i){n.getUserInfo(!0).then((function(s){var l,g=JSON.parse(JSON.stringify(s)),c=!1,d=[].concat(t.key);if(!g.UID&&r){var u=Drupal.urlParam("keywords"),m=u?"?keywords="+u:"",p='<div id="LoginPromptModal" data-modal-state="hidden" class="modal-container modal-container--scroll"><div tabindex="-1" role="dialog" aria-labelledby="modal-label" class="modal modal--small"><div class="modal__image modal__image--login"></div><div class="modal__content modal__content--login"><h2 class="h4" id="modal-label">Sign in <span class="heading-alternative">to favourite</span></h2><div class="grid grid--center"><div class="grid__item">To add to your favourites you will need to sign in. If you don\'t have an account, please register to use all the features available.</div></div></div><footer class="modal__footer"><div class="buttons"><div class="buttons__group"><a class="button button--primary" href="/account?m=login&returnUrl='+window.location.pathname+m+'" role="button">Sign in</a><a class="button button--secondary" href="#" data-modal-close role="button">Cancel</a></div></div><p><small>Don\'t have an account yet? <a href="/account?m=register&returnUrl='+window.location.pathname+m+'">Sign up</a></small></p></footer></div></div>';return 0===e("#LoginPromptModal").length&&(e("body").append(p),e("body").hasClass("v5")||(e("body").addClass("v5-modal"),UCASDesignFramework.v5Modal.init())),e("."+o).removeClass(o+"--working"),void UCASDesignFramework.modal.showModal("LoginPromptModal")}if(g.favourites.hasOwnProperty(t.type)||(g.favourites[t.type]=[]),"top"===t.type){var f=a.find(g.favourites.top,{number:t.data.number});f&&(!1===t.data.course&&(t.data.course={courseId:!1,courseOptionId:!1}),f.course=t.data.course),l=f&&f.course.hasOwnProperty("courseId")&&!1!==f.course.courseId}else{var h=a.findIndex(g.favourites[t.type],a.pick(t.data,d));if(-1!==h){if(g.favourites[t.type].splice(h,1),l=!1,"courses"===t.type&&t.data.courseId&&t.data.courseOptionId){var y=a.findIndex(g.favourites.top,{course:a.pick(t.data,["courseId","courseOptionId"])});-1!==y&&(g.favourites.top[y]={number:g.favourites.top[y].number,course:{courseId:!1,courseOptionId:!1}},c=!0)}}else g.favourites[t.type].push(t.data),l=!0}if(n.updateUserInfo(g),!1!==g.UID){var v={};v[t.type]=g.favourites[t.type].slice(),c&&(v.top=g.favourites.top.slice()),v.hasOwnProperty("top")&&v.top.forEach((function(e,t){e.hasOwnProperty("course")&&!1===e.course&&(v.top[t].course={courseId:!1,courseOptionId:!1})})),n.gigyaTokenFix(),gigya.accounts.setAccountInfo({callback:function(e){403005===e.errorCode&&n.loginRedirect(),console.log("Favourite updated on Gigya"),i({isFavourite:l,updated:g.favourites})},data:{learnerProfile:{favourites:v}}})}else i({isFavourite:l,updated:g.favourites})}))}))},wipeFavourites:function(){return new Promise((function(e){n.getUserInfo(!0).then((function(t){t.favourites=n.defaultFavourites(),n.updateUserInfo(t),n.gigyaTokenFix(),gigya.accounts.setAccountInfo({callback:function(t){403005===t.errorCode&&n.loginRedirect(),console.log("Wiped favourites on Gigya"),e()},data:{learnerProfile:{favourites:t.favourites}}})}))}))},fixLocationFavourites:function(e,t){return Array(t).forEach((function(a,n){if(!a.hasOwnProperty("id")){var r=Array(e).filter((function(e){return e.title===a.title}));r.length>0&&(t[n].id=r[0].id,t[n].type=r[0].type)}})),t},updateSetting:function(e){return new Promise((function(t,r){n.getUserInfo().then((function(o){o.settings=e,n.updateUserInfo(o);var i={},s={},l={},g=a.find(o.settings,{name:"Careers",collection:"exploreData"});if(g){var c=JSON.parse(g.data);[{name:"careerAssessmentId",target:"careerAssessment.id"},{name:"careerAssessmentType",target:"careerAssessment.type"}].forEach((function(e){var t=a.get(c,e.name,!1);(t||""===t)&&a.set(i,e.target,t)}))}var d=a.find(o.settings,{name:"Personalisation",collection:"dashboardUserData"});if(d){c=JSON.parse(d.data);[{name:"gender",target:"gender.name"},{name:"addressLine1",target:"address.addressLine1"},{name:"addressLine2",target:"address.addressLine2"},{name:"addressLine3",target:"address.addressLine3"},{name:"postcode",target:"address.postCode"},{name:"country",target:"address.country.name"},{name:"apprenticeships",target:"interest.apprenticeships"},{name:"conservatoires",target:"interest.conservatoires"},{name:"gapYear",target:"interest.gapYear"},{name:"research",target:"interest.research"},{name:"straightIntoEmployment",target:"interest.straightToEmployment"},{name:"studyOutsideUK",target:"interest.studyAbroad"},{name:"taught",target:"interest.taught"},{name:"teachingEngland",target:"interest.teachingEngland"},{name:"teachingWales",target:"interest.teachingWales"},{name:"teachingScotland",target:"interest.teachingScotland"},{name:"studyRegionScotland",target:"interest.region.studyRegionScotland"},{name:"studyRegionWales",target:"interest.region.studyRegionWales"},{name:"studyRegionNorthernIreland",target:"interest.region.studyRegionNorthernIreland"},{name:"studyRegionEastMidlands",target:"interest.region.studyRegionEastMidlands"},{name:"studyRegionSouthEastEngland",target:"interest.region.studyRegionSouthEastEngland"},{name:"studyRegionNorthEastEngland",target:"interest.region.studyRegionNorthEastEngland"},{name:"studyRegionEastofEngland",target:"interest.region.studyRegionEastOfEngland"},{name:"studyRegionWestMidlands",target:"interest.region.studyRegionWestMidlands"},{name:"studyRegionSouthWestEngland",target:"interest.region.studyRegionSouthWestEngland"},{name:"studyRegionNorthWestEngland",target:"interest.region.studyRegionNorthWestEngland"},{name:"studyRegionGreaterLondon",target:"interest.region.studyRegionGreaterLondon"},{name:"studyRegionYorkshireandtheHumber",target:"interest.region.studyRegionYorkshireAndTheHumber"},{name:"studyRegionNotSure",target:"interest.region.studyRegionNotSure"},{name:"subjects1",target:"interest.subject.subjects1"},{name:"subjects2",target:"interest.subject.subjects2"},{name:"subjects3",target:"interest.subject.subjects3"},{name:"mobile",target:"mobilePhone.number"},{name:"studyLevel",target:"studyLevel"},{name:"studyYear",target:"entryYear"},{name:"userCountry",target:"userHomeCountry.name"},{name:"userPostcode",target:"userHomePostcode"},{name:"stillAtSchool",target:"stillAtSchool"},{name:"schoolId",target:"school.id"},{name:"schoolName",target:"school.name"},{name:"onBoardingConfirmed",target:"onBoardingConfirmed"},{name:"beenInCare",target:"wideningParticipation.beenInCare"},{name:"areCarers",target:"wideningParticipation.areCarers"},{name:"parentResponsibilities",target:"wideningParticipation.parentResponsibilities"},{name:"estrangedStudent",target:"wideningParticipation.estrangedStudent"},{name:"refugeeOrAsylum",target:"wideningParticipation.refugeeOrAsylum"},{name:"serviceChildren",target:"wideningParticipation.serviceChildren"},{name:"veteransAndServiceLeavers",target:"wideningParticipation.veteransAndServiceLeavers"},{name:"disadvantagedBackgrounds",target:"wideningParticipation.disadvantagedBackgrounds"},{name:"mentalHealthWellbeing",target:"wideningParticipation.mentalHealthWellbeing"}].forEach((function(e){var t=a.get(c,e.name,!1);(t||""===t)&&("entryYear"===e.target&&(t=(t=t.toString()).replace(" and beyond","")),a.set(i,e.target,t))})),[{name:"contactEmail",target:"['marketing.contactEmail']['email']['isSubscribed']"},{name:"contactPost",target:"['marketing.contactPost']['email']['isSubscribed']"},{name:"contactSMS",target:"['marketing.contactSMS']['email']['isSubscribed']"},{name:"offers",target:"['marketing.offers']['email']['isSubscribed']"},{name:"tailoredInfo",target:"['marketing.tailoredInfo']['email']['isSubscribed']"},{name:"relevantCourses",target:"['marketing.relevantCourses']['email']['isSubscribed']"},{name:"mentalHealthInformation",target:"['marketing.wellbeingInfo']['email']['isSubscribed']"},{name:"talentPoolJoin",target:"['apprenticeship.talentPool']['email']['isSubscribed']"}].forEach((function(e){var t=a.get(c,e.name,!1);t&&a.set(s,e.target,"yes"===t.toLowerCase())})),[{name:"levelsoptionlevel2",target:"levels.level2"},{name:"levelsoptionlevel3",target:"levels.level3"},{name:"levelsoptionlevel4",target:"levels.level4"},{name:"levelsoptionlevel5",target:"levels.level5"},{name:"talentPoolGCSEMath",target:"grade5GcseMaths"},{name:"talentPoolGCSEEnglish",target:"grade5GcseEnglish"},{name:"talentPoolGCSETotal",target:"grade5GcseQuantity"},{name:"talentPoolTravelDistance",target:"maxTravelDistance"},{name:"talentPoolTravelPostcode",target:"postcode"},{name:"talentPoolStartNow",target:"readyToStartDate"},{name:"talentPoolStartDate",target:"readyToStartDate"},{name:"talentPoolRelocate",target:"willingToRelocate"},{name:"businessAdministrationLaw",target:"sectors.businessAdministrationLaw"},{name:"construction",target:"sectors.construction"},{name:"engineering",target:"sectors.engineering"},{name:"education",target:"sectors.education"},{name:"health",target:"sectors.health"},{name:"informationAndCommunicationTechnology",target:"sectors.informationAndCommunicationTechnology"},{name:"retail",target:"sectors.retail"},{name:"scienceMathematics",target:"sectors.scienceMathematics"},{name:"agricultureHorticultureAnimalCare",target:"sectors.agricultureHorticultureAnimalCare"},{name:"artsMediaPublishing",target:"sectors.artsMediaPublishing"},{name:"socialSciences",target:"sectors.socialSciences"},{name:"leisure",target:"sectors.leisure"},{name:"historyPhilosophyTheology",target:"sectors.historyPhilosophyTheology"},{name:"languagesLiteratureCulture",target:"sectors.languagesLiteratureCulture"},{name:"humanResources",target:"sectors.humanResources"},{name:"uniformedAndDefenceServices",target:"sectors.uniformedAndDefenceServices"}].forEach((function(e){var t=a.get(c,e.name,!1);t&&a.set(l,e.target,t)})),d.data=JSON.stringify(c)}var u=a.findIndex(o.settings,{name:"Statement",collection:"dashboardData"});if(-1!==u){var m=JSON.parse(o.settings[u].data),p=o.settings[u].lastUpdated;a.set(i,"personalStatement.lastUpdated",p),[{name:"achievements",target:"personalStatement.achievements"},{name:"futurePlans",target:"personalStatement.futurePlans"},{name:"previousStudies",target:"personalStatement.previousStudies"},{name:"skills",target:"personalStatement.skills"},{name:"whyApplyCourse",target:"personalStatement.whyApplyCourse"},{name:"whySubject",target:"personalStatement.whySubject"},{name:"whySuitable",target:"personalStatement.whySuitable"},{name:"workExperience",target:"personalStatement.workExperience"}].forEach((function(e){a.set(i,e.target,a.get(m,e.name,""))}))}var f=a.findIndex(o.settings,{name:"Tariff",collection:"dashboardData"});if(-1!==f){var h=JSON.parse(o.settings[f].data),y=o.settings[f].lastUpdated;a.set(i,"tariff.lastUpdated",y),a.set(i,"tariff.qualifications",h)}var v=a.findIndex(o.settings,{name:"Todo",collection:"dashboardTodo"});if(-1!==v){var w=JSON.parse(o.settings[v].data);a.set(i,"toDoList",w)}var b=a.findIndex(o.settings,{name:"Notes",collection:"dashboardData"});if(-1!==b){var S=JSON.parse(o.settings[b].data),P=o.settings[b].lastUpdated;a.set(i,"notes",S),a.set(i,"notes.lastUpdated",P)}var C=[],I=a.findIndex(o.settings,{name:"Active",collection:"dashboardWidgetsActive"});-1!==I&&C.push(o.settings[I]);var k=a.findIndex(o.settings,{name:"Order",collection:"dashboardWidgetsOrder"});-1!==k&&C.push(o.settings[k]);var O=a.findIndex(o.settings,{name:"EventBooking",collection:"events"});-1!==O&&C.push(o.settings[O]),o.settings.forEach((function(e){"dashboardSettings"===e.collection&&C.push(e)})),!1!==o.UID&&(n.gigyaTokenFix(),gigya.accounts.setAccountInfo({callback:function(e){console.log("Settings updated on Gigya"),e.hasOwnProperty("errorCode")&&0===e.errorCode?t(e):403005===e.errorCode?n.loginRedirect():r(e)},data:{apprenticeship:l,learnerProfile:i,dashboardSettings:JSON.stringify(C)},subscriptions:JSON.stringify(s)}))}))}))},loginCallback:function(e,t){var a="boolean"==typeof t&&!0===t;n.ssoCalled=!e.hasOwnProperty("UID")||e.hasOwnProperty("loginMode")&&"reAuth"===e.loginMode;var r=n.ssoCalled?"Checking access, please wait":"Signing you in, please wait",o=document.createElement("div");o.innerHTML='<div class="loading-spinner loading-spinner--gigya" style="position: fixed; top: 0; right: 0; left: 0; bottom: 0;"><span>'+r+"</span></div>",document.body.appendChild(o.firstChild);try{n.getFingerprint((function(t){n.gigyaTokenFix(),gigya.accounts.getJWT({fields:"data.userTypes, lastLoginTimestamp, data.lastLoginDevice, data.learnerProfile.interest.teachingEnglandWales, email, loginIDs.emails",callback:function(r){403005===r.errorCode&&n.loginRedirect();var o={token:r.id_token,level:n.settings.level||10,profile:e.profile||{},loginMode:e.loginMode||"login",hash:t},i=new RegExp("[?&]returnUrl=([^&#]*)","i").exec(window.location.search);o.returnUrl=!!i&&i[1],n.drupalAjaxRequest("/account/login-callback?redirect="+(a?"false":"true"),o)}})}))}catch(e){n.displayLoginError("Failed fetching login token."),n.gigyaLogout()}},syncToBackend:function(){return new Promise((function(e,t){try{n.getFingerprint((function(a){n.gigyaTokenFix(),gigya.accounts.getJWT({callback:function(n){403005!==n.errorCode?0===n.errorCode?e({token:n.id_token,hash:a}):t(n.errorMessage):e({token:!1,hash:!1})},expiration:3600})}))}catch(e){t(e)}}))},logoutCallback:function(e){n.clearUserInfo(),setTimeout((function(){"/account/logout"===window.location.pathname?window.location.pathname="/":window.location.reload()}),5e3)},screenSetSubmit:function(e){window.scrollTo(0,0),"gigya-profile-form"===e.form&&e.hasOwnProperty("profile")&&n.setUserInfo(e.response)},setUserInfo:function(e){var t=localStorage.getItem("UcasGigyaSessionInfo");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}else t={};t.UID=!1,t.expires=Math.floor(Date.now()/1e3)+1200,e.hasOwnProperty("UID")&&(t.UID=e.UID),t.complete=0,e.hasOwnProperty("profile")&&[{name:"email",target:"email"},{name:"firstName",target:"firstName"},{name:"lastName",target:"lastName"},{name:"birthYear",target:"birthYear"},{name:"country",target:"country"},{name:"zip",target:"postcode"},{name:"thumbnailURL",target:"avatar"}].forEach((function(a){e.profile.hasOwnProperty(a.name)&&(t[a.target]=e.profile[a.name],t.complete++)}));var r=n.defaultFavourites(),o=t.hasOwnProperty("settings")?t.settings:[];e.hasOwnProperty("data")&&e.data.hasOwnProperty("dashboardSettings")&&(o=JSON.parse(e.data.dashboardSettings));var i=a.find(o,{name:"Personalisation",collection:"dashboardUserData"}),s={};if(i&&(s=JSON.parse(i.data)),e.hasOwnProperty("subscriptions")&&[{name:"marketing.contactEmail.email.isSubscribed",target:"contactEmail"},{name:"marketing.contactPost.email.isSubscribed",target:"contactPost"},{name:"marketing.contactSMS.email.isSubscribed",target:"contactSMS"},{name:"marketing.offers.email.isSubscribed",target:"offers"},{name:"marketing.tailoredInfo.email.isSubscribed",target:"tailoredInfo"},{name:"marketing.relevantCourses.email.isSubscribed",target:"relevantCourses"},{name:"marketing.wellbeingInfo.email.isSubscribed",target:"mentalHealthInformation"},{name:"apprenticeship.talentPool.email.isSubscribed",target:"talentPoolJoin"}].forEach((function(t){var n=a.get(e.subscriptions,t.name,!1),r="tailoredInfo"===t.target||"offers"===t.target||"relevantCourses"===t.target||"talentPoolJoin"===t.target?"Yes":"yes",o="tailoredInfo"===t.target||"offers"===t.target||"relevantCourses"===t.target||"talentPoolJoin"===t.target?"No":"no";n?a.set(s,t.target,n?r:o):a.set(s,t.target,o)})),e.hasOwnProperty("data")&&e.data.hasOwnProperty("apprenticeship")&&[{name:"levels.level2",target:"levelsoptionlevel2"},{name:"levels.level3",target:"levelsoptionlevel3"},{name:"levels.level4",target:"levelsoptionlevel4"},{name:"levels.level5",target:"levelsoptionlevel5"},{name:"desiredLevels",target:"talentPoolStudyLevel"},{name:"grade5GcseMaths",target:"talentPoolGCSEMath"},{name:"grade5GcseEnglish",target:"talentPoolGCSEEnglish"},{name:"grade5GcseQuantity",target:"talentPoolGCSETotal"},{name:"maxTravelDistance",target:"talentPoolTravelDistance"},{name:"postcode",target:"talentPoolTravelPostcode"},{name:"readyToStartDate",target:"talentPoolStartNow"},{name:"readyToStartDate",target:"talentPoolStartDate"},{name:"willingToRelocate",target:"talentPoolRelocate"},{name:"sectors.businessAdministrationLaw",target:"businessAdministrationLaw"},{name:"sectors.construction",target:"construction"},{name:"sectors.engineering",target:"engineering"},{name:"sectors.health",target:"health"},{name:"sectors.informationAndCommunicationTechnology",target:"informationAndCommunicationTechnology"},{name:"sectors.retail",target:"retail"},{name:"sectors.scienceMathematics",target:"scienceMathematics"},{name:"sectors.agricultureHorticultureAnimalCare",target:"agricultureHorticultureAnimalCare"},{name:"sectors.artsMediaPublishing",target:"artsMediaPublishing"},{name:"sectors.socialSciences",target:"socialSciences"},{name:"sectors.leisure",target:"leisure"},{name:"sectors.historyPhilosophyTheology",target:"historyPhilosophyTheology"},{name:"sectors.languagesLiteratureCulture",target:"languagesLiteratureCulture"},{name:"sectors.humanResources",target:"humanResources"},{name:"sectors.education",target:"education"},{name:"sectors.uniformedAndDefenceServices",target:"uniformedAndDefenceServices"}].forEach((function(t){var n=a.get(e.data.apprenticeship,t.name,!1);n&&a.set(s,t.target,n)})),e.hasOwnProperty("data")&&e.data.hasOwnProperty("learnerProfile")){[{name:"gender.name",target:"gender"},{name:"address.addressLine1",target:"addressLine1"},{name:"address.addressLine2",target:"addressLine2"},{name:"address.addressLine3",target:"addressLine3"},{name:"careerAssessment.id",target:"careerAssessmentId"},{name:"careerAssessment.type",target:"careerAssessmentType"},{name:"address.postCode",target:"postcode"},{name:"address.country.name",target:"country"},{name:"interest.apprenticeships",target:"apprenticeships"},{name:"interest.conservatoires",target:"conservatoires"},{name:"interest.gapYear",target:"gapYear"},{name:"interest.research",target:"research"},{name:"interest.straightToEmployment",target:"straightIntoEmployment"},{name:"interest.studyOutsideUK",target:"studyAbroad"},{name:"interest.taught",target:"taught"},{name:"interest.teachingEngland",target:"teachingEngland"},{name:"interest.teachingWales",target:"teachingWales"},{name:"interest.teachingScotland",target:"teachingScotland"},{name:"interest.region.studyRegionScotland",target:"studyRegionScotland"},{name:"interest.region.studyRegionWales",target:"studyRegionWales"},{name:"interest.region.studyRegionNorthernIreland",target:"studyRegionNorthernIreland"},{name:"interest.region.studyRegionEastMidlands",target:"studyRegionEastMidlands"},{name:"interest.region.studyRegionSouthEastEngland",target:"studyRegionSouthEastEngland"},{name:"interest.region.studyRegionNorthEastEngland",target:"studyRegionNorthEastEngland"},{name:"interest.region.studyRegionEastOfEngland",target:"studyRegionEastofEngland"},{name:"interest.region.studyRegionWestMidlands",target:"studyRegionWestMidlands"},{name:"interest.region.studyRegionSouthWestEngland",target:"studyRegionSouthWestEngland"},{name:"interest.region.studyRegionNorthWestEngland",target:"studyRegionNorthWestEngland"},{name:"interest.region.studyRegionGreaterLondon",target:"studyRegionGreaterLondon"},{name:"interest.region.studyRegionYorkshireAndTheHumber",target:"studyRegionYorkshireandtheHumber"},{name:"interest.region.studyRegionNotSure",target:"studyRegionNotSure"},{name:"interest.subject.subjects1",target:"subjects1"},{name:"interest.subject.subjects2",target:"subjects2"},{name:"interest.subject.subjects3",target:"subjects3"},{name:"mobilePhone.number",target:"mobile"},{name:"studyLevel",target:"studyLevel"},{name:"entryYear",target:"studyYear"},{name:"userHomeCountry.name",target:"userCountry"},{name:"userHomePostcode",target:"userPostcode"},{name:"stillAtSchool",target:"stillAtSchool"},{name:"school.id",target:"schoolId"},{name:"school.name",target:"schoolName"},{name:"onBoardingConfirmed",target:"onBoardingConfirmed"},{name:"wideningParticipation.beenInCare",target:"beenInCare"},{name:"wideningParticipation.areCarers",target:"areCarers"},{name:"wideningParticipation.parentResponsibilities",target:"parentResponsibilities"},{name:"wideningParticipation.estrangedStudent",target:"estrangedStudent"},{name:"wideningParticipation.refugeeOrAsylum",target:"refugeeOrAsylum"},{name:"wideningParticipation.serviceChildren",target:"serviceChildren"},{name:"wideningParticipation.veteransAndServiceLeavers",target:"veteransAndServiceLeavers"},{name:"wideningParticipation.disadvantagedBackgrounds",target:"disadvantagedBackgrounds"},{name:"wideningParticipation.mentalHealthWellbeing",target:"mentalHealthWellbeing"}].forEach((function(t){var n=a.get(e.data.learnerProfile,t.name,!1);n&&a.set(s,t.target,n)})),i?i.data=JSON.stringify(s):o.push({name:"Personalisation",collection:"dashboardUserData",data:JSON.stringify(s)});var l=a.find(o,{name:"Careers",collection:"exploreData"}),g={};if(l&&(g=JSON.parse(l.data)),[{name:"careerAssessment.id",target:"careerAssessmentId"},{name:"careerAssessment.type",target:"careerAssessmentType"}].forEach((function(t){var n=a.get(e.data.learnerProfile,t.name,!1);n&&a.set(g,t.target,n)})),l?l.data=JSON.stringify(g):o.push({name:"Careers",collection:"exploreData",data:JSON.stringify(g)}),e.data.learnerProfile.hasOwnProperty("personalStatement")){var c=a.find(o,{name:"Statement",collection:"dashboardData"}),d={};c&&(d=JSON.parse(c.data)),[{name:"personalStatement.achievements",target:"achievements"},{name:"personalStatement.futurePlans",target:"futurePlans"},{name:"personalStatement.previousStudies",target:"previousStudies"},{name:"personalStatement.skills",target:"skills"},{name:"personalStatement.whyApplyCourse",target:"whyApplyCourse"},{name:"personalStatement.whySubject",target:"whySubject"},{name:"personalStatement.whySuitable",target:"whySuitable"},{name:"personalStatement.workExperience",target:"workExperience"}].forEach((function(t){a.set(d,t.target,a.get(e.data.learnerProfile,t.name,""))})),c?c.data=JSON.stringify(d):o.push({name:"Statement",collection:"dashboardData",data:JSON.stringify(d)})}if(e.data.learnerProfile.hasOwnProperty("tariff")&&e.data.learnerProfile.tariff.hasOwnProperty("qualifications")){var u=a.find(o,{name:"Tariff",collection:"dashboardData"});u?u.data=JSON.stringify(e.data.learnerProfile.tariff.qualifications):o.push({name:"Tariff",collection:"dashboardData",data:JSON.stringify(e.data.learnerProfile.tariff.qualifications)})}if(e.data.learnerProfile.hasOwnProperty("toDoList")){var m=a.find(o,{name:"Todo",collection:"dashboardTodo"});m?m.data=JSON.stringify(e.data.learnerProfile.toDoList):o.push({name:"Todo",collection:"dashboardTodo",data:JSON.stringify(e.data.learnerProfile.toDoList)})}if(e.data.learnerProfile.hasOwnProperty("notes")){var p=a.find(o,{name:"Notes",collection:"dashboardData"});p?p.data=JSON.stringify(e.data.learnerProfile.notes):o.push({name:"Notes",collection:"dashboardData",data:JSON.stringify({text:e.data.learnerProfile.notes.text}),lastUpdated:e.data.learnerProfile.notes.lastUpdated})}if(e.data.learnerProfile.hasOwnProperty("favourites"))for(var f in e.data.learnerProfile.favourites)e.data.learnerProfile.favourites.hasOwnProperty(f)&&(r[f]=e.data.learnerProfile.favourites[f])}if(t.settings=o,t.favourites=r,e.hasOwnProperty("data")&&e.data.hasOwnProperty("userTypes")){var h=e.data.userTypes,y="student";"string"==typeof h&&(y=h.split(",")[0]),t.userType=String(y).toLowerCase(),"student"!==t.userType&&n.setCookie("ucasGigyaSoft","",-1)}n.updateUserInfo(t)},defaultFavourites:function(){return{courses:[],top:[{number:1,course:{courseId:!1,courseOptionId:!1}},{number:2,course:{courseId:!1,courseOptionId:!1}},{number:3,course:{courseId:!1,courseOptionId:!1}},{number:4,course:{courseId:!1,courseOptionId:!1}},{number:5,course:{courseId:!1,courseOptionId:!1}}],subjects:[],unis:[],locations:[],filters:[],pages:[],careerPathways:[],careerCareers:[]}},awaitCheckLogin:function(e){return new Promise((function(t){if(e||!1===n.fetching)return t();var a=setInterval((function(){if(!1===n.fetching)return clearInterval(a),t()}),50)}))},getUserInfo:function(e,t){return new Promise((function(a){n.awaitCheckLogin(t).then((function(){var t=localStorage.getItem("UcasGigyaSessionInfo")||{};if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}if(!n.hasGigyaSession&&t.hasOwnProperty("UID")&&!1!==t.UID&&n.clearUserInfo(),t.hasOwnProperty("expires")){var r=Math.floor(Date.now()/1e3);t.expires<r&&(e=!0)}return(!t.hasOwnProperty("UID")||t.hasOwnProperty("UID")&&!1===t.UID)&&(e=!0),e=e&&n.hasGigyaSession,"check"===n.getQueryArgument("auth")&&(e=!0),n.userData&&n.userData.hasOwnProperty("UID")&&!e?(n.fetching=!1,a(n.userData)):t.hasOwnProperty("UID")&&!e?(n.userData=t,n.fetching=!1,a(t)):void(e?(console.log("Refreshing cached Gigya data"),n.gigyaTokenFix(),gigya.accounts.getAccountInfo({include:"profile,data,subscriptions",callback:function(e){var r=void 0!==e&&0===e.errorCode;n.fetching=!1,t={},r?t=e:(n.clearUserInfo(),window.location.reload()),n.setUserInfo(t),console.log("Fetched account data from Gigya"),a(n.userData)}})):(n.fetching=!1,n.setUserInfo({}),a(n.userData)))}))}))},updateUserInfo:function(e){if(e.hasOwnProperty("settings")){var t=a.find(e.settings,{name:"Personalisation",collection:"dashboardUserData"});if(t&&t.hasOwnProperty("data")){var r=JSON.parse(t.data);e.postcode=a.get(r,"userPostcode",""),""===e.postcode&&(e.postcode=a.get(r,"postcode","")),e.postcode=e.postcode.toString().toUpperCase()}}n.userData=e,localStorage.setItem("UcasGigyaSessionInfo",JSON.stringify(e))},clearUserInfo:function(){console.log("Clearing Gigya cache"),localStorage.removeItem("UcasGigyaSessionInfo")},getCookie:function(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return!!t&&t.pop()},removeCookie:function(e){this.setCookie(e,"",-1)},setCookie:function(e,t,a){var n=new Date;n.setSeconds(n.getSeconds()+a),document.cookie=e+"="+t+";domain="+(-1!==window.location.hostname.indexOf("ucas.com")?".ucas.com":".ucasenvironments.com")+";path=/;expires="+n.toUTCString()},getQueryArgument:function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(window.location.search);return!!t&&t[1]},replaceLoginMenu:function(){n.getUserInfo().then((function(e){e.ucasComUrl=n.settings.hasOwnProperty("ucasComUrl")?n.settings.ucasComUrl:"https://www.ucas.com",e.digitalUrl=n.settings.hasOwnProperty("digitalUrl")?n.settings.digitalUrl:"https://digital.ucas.com",e.accountsUrl=n.settings.hasOwnProperty("accountsUrl")?n.settings.accountsUrl:"https://accounts.ucas.com",setTimeout((function(){UCASDesignFramework.userMenu.updateUserMenu(e)}),500)}))},drupalAjaxRequest:function(t,a){var n=e('<div id="ajaxRequestContainer" style="display: none;"></div>');e("body").append(n);var r=new Drupal.ajax("ajaxRequestContainer",n,{url:t,event:"gigyaAjaxRequest",wrapper:"ajaxRequestContainer"});r.options.data=a,r.options.data.hasOwnProperty("requestParams")&&delete r.options.data.requestParams;try{n.trigger("gigyaAjaxRequest").unbind("gigyaAjaxRequest")}catch(e){this.gigyaLogout()}},bindClickHandlers:function(){setTimeout((function(){e('a[href$="/user/logout"]').click((function(e){e.preventDefault(),n.gigyaLogout()})),e(".page-providers .header .button").click((function(e){n.setCookie("ucasGigyaSoft","",-1)}))}),500)},gigyaLogout:function(t){t=t||{};var a=e('<div class="loading-spinner loading-spinner--gigya" style="position: fixed; top: 0; right: 0; left: 0; bottom: 0;"><span>Logging you out, please wait</span></div>');(e("body").append(a),n.gigyaTokenFix(),n.clearUserInfo(),this.removeCookie("ucasGigyaLogout"),this.hasGigyaSession=!1,"/account/external-logout"!==window.location.pathname)?!!t.hasOwnProperty("useCentralLogin")&&t.useCentralLogin?window.location="/user/logout":gigya.accounts.logout():a.remove()},displayLoginError:function(t){var a=e(".loading-spinner.loading-spinner--gigya");0===a.length?(a=e('<div class="loading-spinner loading-spinner--gigya.loading-spinner--error" style="position: fixed; top: 0; right: 0; left: 0; bottom: 0;"><span>Logging you out, please wait</span></div>'),e("body").append(a)):a.addClass("loading-spinner--error");var n='<strong>Something unexpected happened when you tried to sign in</strong><br />Try signing out and back in again. If this problem persists, please <a href="/contact-us">contact us</a>.<br /><small>'+t+"</small>";a.find("span").html(n)},getFingerprint:function(e){Fingerprint2.get({},(function(t){var a=t.map((function(e){return e.value})),n=Fingerprint2.x64hash128(a.join(""),31);return e(n)}))}};t.ucasGigya={loginCallback:n.loginCallback,userData:n.userData,syncToBackend:n.syncToBackend,hasGigyaSession:n.hasGigyaSession,hasDrupalLogin:n.hasDrupalLogin,getUserInfo:n.getUserInfo,toggleFavourite:n.toggleFavourite,updateSetting:n.updateSetting,wipeFavourites:n.wipeFavourites,setFavourites:n.setFavourites,createFavouriteLink:n.createFavouriteLink},window.hasOwnProperty("Drupal")&&window.hasOwnProperty("gigya")&&(Drupal.behaviors.gigya={attach:function(t,a){var r=e("#gigya-logout-trigger",t);r.length>0?r.once("gigyaLogout",(function(){n.gigyaLogout(a)})):e("body").once("gigyaInit",(function(){n.checkLogin(t,a)}))}},Drupal.behaviors.favourites={attach:function(t,a){var r=e("[data-card-info]",t);r.length&&r.each((function(){var t=e(this),a=t.data("card-info");if(a.type&&(a.title||"unis"===a.type)){var r=["title"],o={};a.hasOwnProperty("title")&&(o.title=a.title),a.hasOwnProperty("id")&&("unis"===a.type?(o.providerId=a.id,r=["providerId"]):(o.id=a.id,r=["id"]));var i=n.createFavouriteLink({key:r,type:a.type,data:o},{additionalClasses:"button inverse transition--hover-stop",class:"button--favourite",element:"<button>Favourite this event</button>",wrapperElement:!1});t.find(".button--favourite").replaceWith(i)}}))}}),e((function(){if(window.hasOwnProperty("gigya"))gigya.accounts.addEventHandlers({onLogin:n.loginCallback,onLogout:n.logoutCallback});else{var t=e("#ucas-gigya-screenset");if(t.length>0){var a=e('<div class="ucas-gigya-screenset__wrapper"><div class="ucas-gigya-screenset__form"><h1 class="ucas-gigya-screenset__header" style="font-size: 3em;">Oops – something\'s gone wrong</h1><p><strong>Try:</strong></p><ul class="bullets"><li>Refreshing this page</li><li>Pressing Ctrl + F5</li></ul><p><strong>Still not working?</strong> You may need help from your IT Team to access this page. Please ask them to whitelist the following:</p><ul class="bullets"><li>gigya.com</li><li>*.gigya.com</li><li>gigya-api.com</li><li>*.gigya-api.com</li><li>mail-service@gigya-raas.com</li></ul></div></div>');e(".section--content").addClass("ucas-gigya-login-screen"),t.append(a)}UCASDesignFramework.userMenu.updateUserMenu({UID:!1,firstName:"",userType:"student",avatar:"",digitalUrl:n.settings.hasOwnProperty("digitalUrl")?n.settings.digitalUrl:"https://digital.ucas.com",ucasComUrl:n.settings.hasOwnProperty("ucasComUrl")?n.settings.ucasComUrl:"https://www.ucas.com"})}window.hasOwnProperty("Drupal")&&(Drupal.ajax.prototype.commands.loginRedirect=function(e,t){var a=decodeURIComponent(t.redirectTarget?t.redirectTarget:window.location.href);window.location.href===a?window.location.reload():window.location=a},Drupal.ajax.prototype.commands.clearCache=function(){n.clearUserInfo()},Drupal.ajax.prototype.commands.reload=function(){window.location.reload()},Drupal.ajax.prototype.commands.logout=function(){n.gigyaLogout()},Drupal.ajax.prototype.commands.displayLoginError=function(e,t){n.displayLoginError(t.message)})}))}(jQuery,window,_);